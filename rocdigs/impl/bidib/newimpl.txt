> da ich schon einiges in Rocrail implementiert habe, und was eigentlich > gut funktioniert, mÃ¶chte ich doch wissen was genau am Protokoll
> geaendert worden ist, und ab welche Firmware Version...

Entschuldigung Rob, im Showdown und Debuggen der letzten Tage ist die Kommunikation etwas zurückgegebleiben. Die Änderung für Dich ist nicht tragisch, es betrifft nur das Abholen der Tabellen für NODE und Features.
(siehe hierzu auch http://www.bidib.org/support/feature.html )

Nach dem Verbindungsaufbau (GET_SYS_MAGIC) kommt das Abfragen der NODETAB und der Features. Hier schickst Du:

MSG_NODETAB_GETALL
Der Knoten antwortet mit MSG_NODETAB_COUNT (da steht dann die Anzahl 
der Knoten drin)

Die holst Du mit: MSG_NODETAB_GETNEXT ab, jedes MSG_NODETAB_GETNEXT bringt eine Nachricht MSG_NODETAB (die ist formatiert wie bisher), solange bis auf MSG_NODETAB_GETNEXT der Knoten sagt: MSG_NODETAB_NA(255).
Dann sind alle übertragen.

Bei Features ist es genauso:

MSG_FEATURE_GETALL  → 
← MSG_FEATURE_COUNT
MSG_FEATURE_GETNEXT → 
← MSG_FEATURE (3)
MSG_FEATURE_GETNEXT → 
← MSG_FEATURE (5)
MSG_FEATURE_GETNEXT → 
← MSG_FEATURE (7)
MSG_FEATURE_GETNEXT → 
← MSG_FEATURE_NA (255)

Du darfst das ruhig ein bischen vorspannen, also gleich nach dem GETALL ein GETNEXT hinterher schicken, es kommt dann _COUNT und gleich ein Eintrag.

Wie schon gesagt, wenn im Downstream bei einem Knoten Nachrichten eintreffen, welche im Upstream extrem viel Datenverkehr auslösen (z.B. FEATURE_GETALL), dann läuft der Knoten mitten im Parsen der Nachricht auf einen vollen Ausgangspuffer - und steht vor der Zwickmühle: parsen aussetzen und warten bis upstream wieder frei wird, weiterparsen und downstream-Nachrichten ignorieren oder jeweils Threads aufziehen, welche die Nachrichten peu-a-peu absenden. Das mit den Threads hatte ich schon gebaut, frist aber Speicher und gerade auf lowcost-Micros ist das noch nicht im Überfluss da. 

Insgesamt darf jedem Knoten im Downstream je Paket nur so viel zugleich aufgetragen werden, dass die Antworten unter 48 Byte bleiben. Ich habe das in der Spec entsprechend ergänzt. Man darf also durchaus normale Nachrichten und Abfragen an den Knoten bündeln, aber Kommunikation ist immer ein Miteinanderreden zweier Teilnehmer - wenn einer bockig ist, funktioniert es nicht. Und bei Gigabit-Ethernet gibt es ähnlich Konstrukte, wenn da ein 100MBit Teilnehmer dabei ist, müssen die anderen 'throtteln'.

> Muss die BiDiGBM neu geflasht werden?

Ja.